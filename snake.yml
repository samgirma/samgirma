name: Generate GitHub Activity Snake

# Controls when the workflow should run
on:
  schedule:
    # Runs every 12 hours (e.g., 00:00 and 12:00 UTC)
    - cron: "0 */12 * * *"

  # Allows manual execution from the Actions tab
  workflow_dispatch:

  # Runs on pushes to the master branch
  push:
    branches:
      - master

jobs:
  generate_snake: # Renamed job for clarity
    permissions:
      contents: write # Needed to push the generated file to the 'output' branch
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      # Step 1: Checkout the repository code
      # This is crucial for the subsequent steps to access and modify files.
      - name: Checkout repository
        uses: actions/checkout@v4 # Use the latest version

      # Step 2: Generate the snake SVG
      - name: Generate snake.svg
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          # Set the output path relative to the checkout directory
          outputs: dist/snake.svg?palette=github-dark, dist/snake-dark.svg?palette=github-dark # Optional: Generate an extra dark version
          # Ensure you use 'dist/' as the prefix if that's where you want the file to be built.

      # Step 3: Push the generated SVG to the 'output' branch
      # This step handles commit and push logic
      - name: Push generated files to output branch
        uses: crazy-max/ghaction-github-pages@v4 # Use the latest recommended version
        with:
          target_branch: output
          build_dir: dist # Directory containing the generated files
          commit_message: "ðŸŽ¨ Update snake animation (Auto-generated by GitHub Actions)" # Provide a clear commit message
        env:
          # The default GITHUB_TOKEN is usually sufficient and is recommended.
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
